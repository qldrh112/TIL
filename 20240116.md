# 2024.01.16

## 제목

### 08. 웹 페이지 만들기
* 방문자를 위한 경로를 지정하고, 대응하는 페이지 구성 방법 살펴보기  
-> 장고를 사용했을 때 만들 수 있는 기본적인 웹 페이지 구성

#### 08-1 URL 설정하기
웹 사이트에는 맨 처음 방문자를 맞닥들이는 대문 페이지부터 로그인 페이지 등 여러 페이지로 나누어 볼 수 있다.

##### 표지판 역할을 하는 uris.py
`uris.py`는 웹 페이지에 방문한 사람을 위한 이정표 역할을 수행한다고 생각할 수 있다.  
ex) <u>서버/admin</u> 으로 접속했을 때 관리자 페이지로 접근할 수 있었다.
왜 why? admin.site.urls에서 그곳으로 안내하라고 정의하였기 때문에

실제로 장고 프로젝트를 생성했을 때 다음과 같이 생성되어 있다.
``` python
from django.contrib import admin
from django.urls import path, include

urlpatterns = [
    # admin/ 으로 접속했을 때, admin.site.urls을 동작해라
    path("admin/", admin.site.urls),
]
```
##### 필요한 페이지 살펴보기

- 대문 페이지
- 블로그 페이지 - 포스트목록 페이지, 포스트 상세 페이지
- 자기소개 페이지 

![image](https://github.com/qldrh112/TIL/assets/69291489/2b6e77e4-c29a-4a8f-b6cc-ac0dc7f158ff)
아직 md 파일에 표를 넣는 것보다 엑셀에서 만들어서 사진으로 붙여넣는 것이 편하긴 하다.

##### 포스트 목록 페이지 만들기
위의 표에 따라서 포스트 목록을 만들기 위해서는 방문자가 /blog로 접속할 수 있게 해야 한다.

###### 블로그 페이지 URL로 접속하기
그러나 우리는 아직 `uris.py`에 `/blog` 로 접속할 수 있게 만들지 않았으므로 404 오류가 발생한다.

그래서 `uris.py`에 방문자가 `/blog`로 접속하였을 때의 행동을 다음과 같이 정의한다. 

``` python
from django.contrib import admin
from django.urls import path, include

urlpatterns = [
    # 방문자가 blog/로 접속햇을 때, blog 폴더의 urls을 참고하시오.
    path("blog/", include('blog.urls')),
    path("admin/", admin.site.urls),
```

중요한 사실은 include도 django.urls에서 데리고 와야 한다.
안 그러면 오류가 발생한다.

###### blog/uris.py 만들기
허나 이것이 끝이 아니라 /blog에는 `urls.py`가 존재하지 않으므로 다음과 같은 코드를 작성하여 생성해야 한다.

``` python
from django.urls import path
from . import views # 해당 디렉터리에서 views를 참고한다?

urlpatterns = [
    # 이 부분을 채울 것입니다.
]
```

`urls.py`에서는 urlpatterns의 리스트에 특정 url과 그 접속에 대응하는 동작을 정의해야 한다.

#### 08-2 FBV로 페이지 만들기
`urls.py`에서 사용하는 view는 무엇일까?  
바로 urls.py의 접속 시 행동을 정의하는 함수로 이루어지는 파일이다.

##### FBV와 CBV
>FBV: 함수에 기반을 둔 기법(Function Based view)  
>CBV: 장고가 제공하는 클래스를 활용해 구현하는 방법(Class Based View)

##### FBV로 포스트 목록 페이지 만들기
###### blog/uris.py 내용 추가하기
`blog/uris.py`에 다음과 같은 코드를 작성한다.
``` python 
from django.urls import path
from . import views

urlpatterns = [
    # 접속 url이 /blog/로 끝난다면, views.index 함수를 실행하라.
    path('', views.index),
]
```

###### blog/views.py에 index() 함수 정의하기
`views.py`에서 index라는 함수를 동작한다고 하였으므로 `views.py`에서 해당 함수를 정의해야 한다.
``` python 
from django.shortcuts import render

# Create your views here.
def index(request):
    # render = 보여준다.
    return render(
        # 요청과 html 파일을
        request,
        'blog/index.html',
    )
```
index 함수가 실행되면 이용자에게 html 파일을 보내주는 것이다.

###### 템플릿 파일 만들기
이제 이용자에게 보여줄 `index.html` 파일을 작성하면 된다.  

blog/templates/blog 순서로 폴더를 구성한 다음 `index.html` 파일을 생성한다. 아직 그 이유에 대해 명확하게 알기 어렵지만, 템플릿이라는 것이 여러 군데에 많이 필요하기 때문일 것으로 사료된다.

`index.html` 파일은 다음과 같이 구성하자
``` html
<!DOCTYPE html>
<!-- 한국어로 된 문서다. -->
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>Blog</title>
</head>

<body>
    <h1>Blog</h1>
</body>

</html>
```
이상의 `urls.py`와 `view.py` 그리고 `index.html`을 모두 수정하고 <u>웹 서버/blog/</u> 에 접속하였을 때, head와 body가 모두 드러나면 성공이다.

###### 블로그 페이지에 포스트 목록 나열하기
블로그 페이지에 포스트 목록을 나열하기 위해서는 접속 시 이벤트에 대한 함수를 담당하는 `view.py`에서 코드를 입력하면 된다.  
다음과 같이 코드를 입력해보자.
``` python
from django.shortcuts import render
# models.py에 정의된 Post 클래스를 데려온다.
from .models import Post

# Create your views here.
def index(request):
    # Post 클래스의 모든 객체를 posts에 저장한다.
    posts = Post.objects.all()

    return render(
        request,
        'blog/index.html',
        {
            # 딕셔너리 형태로 posts를 추가
            'posts': posts
        }
    )
```
우리는 이 코드를 통해서 `views.py`에서 원하는 데이터를 추출할 수 있다는 사실을 새롭게 알 수 있다.

※ 쿼리: DB의 데이터를 가져오거나 수정, 삭제 하는 등의 행위를 하기 위한 요청

그러나 방문자에게는 우리가 `views.py`에서 추출한 데이터를 볼 수 없으므로 index.html에서 posts를 보여줄 수 있도록 하자.
``` html
<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>Blog</title>
</head>

<body>
    <h1>Blog</h1>
    <!-- 중괄호 안에 있는 것은 프로그래밍 언어로 인식한다. -->
    {% for p in posts %}
    <h3>{{ p }}</h3>
    {% endfor %}
</body>

</html>
```
`model.py` 에서 __str()__에 정의한대로 포스트 제목과 번호를 나타낸다.

왜 p를 두 번 감싸는지는 연구를 해봐야 하는 부분이다.

###### Post 모델의 필드값 보여주기
posts의 각 요소를 `index.html`을 수정함으로써 보여줄 수 있다.
``` html
<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>Blog</title>
</head>

<body>
    <h1>Blog</h1>
    {% for p in posts %}
    <hr />
    <!-- 포스트의 제목 -->
    <h2>{{p.title}}</h2>
    <!-- 포스트의 생성 시각 -->
    <h4>{{p.created_at}}</h4> 
    <!-- 포스트의 내용 -->
    <p>{{p.content}}</p>
    {% endfor %}
</body>

</html>
```
마찬 가지로 posts의 필드값을 왜 중괄호로 2번 감는지 확인해야 할 필요가 있다.

###### 최신 포스트부터 보여주기
보통의 블로그는 최신순으로 포스팅을 보여준다. 순서를 정하는 것은 views.py에서 posts를 `order_by` 함수로 정렬하면 조정 가능하다.

`posts = Post.objects.all().order_by('-pk')`

pk는 각 포스팅을 구분하는 기본키이기 때문에 생성될 때마다 하나씩 부여되는 pk를 통해 원하는대로 정렬이 가능하다.

##### FBV로 포스트 상세 페이지 만들기

###### single_post_page() 함수 정의하기

###### URL을 이용한 쿼리 확인하기

###### 템플릿 파일 만들기

##### 포스트 제목에 링크 만들기

###### index.html 수정하기

###### get_absolute_url() 함수 정의하기

##### 대문 페이지와 자기소개 페이지 만들기

###### single_pages 앱을 위한 URL 지정하기

###### 대문 페이지와 자기소개 페이지의 URL 지정하기

###### views.py에 함수 정의하기

###### 템플릿 파일 만들기

#### 08-3 CBV로 페이지 만들기

##### CBV로 포스트 목록 페이지 만들기

###### ListView로 포스트 목록 페이지 만드리

###### urls.py 수정하기

###### 템플릿 파일 지정하기

###### 최신 포스트부터 보여주기

##### CBV로 포스트 상세 페이지 만들기

###### DetailView로 포스트 상세 페이지 만들기

###### uris.py 수정하기

###### 템플릿 파일 지정하기

## 수업

### github 계정 연결 해제하기