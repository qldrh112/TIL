# 20240117
## 제목
### Django
##### FBV로 포스트 상세 페이지 만들기
content가 지금은 블로그 목록과 함께 존재하여 글이 길어지면 번잡할 수 있다. 그러므로 상세 페이지로 내용을 옮기도록 하자.

###### 포스트 상세 페이지 URL 정의하기
먼저 표지판의 기능을 수행하는 `urls.py`에 다음과 같은 코드를 추가합니다.
``` python
from django.urls import path
from . import views

urlpatterns = [
    #   /blog/숫자형태라면 views.single_post_page를 실행하라.
    path('/<int:pk>/', views.single_post_page),
    path('', views.index),
]
```
그렇다면 이제 `views.py`에서 single_post_page 함수를 정의하면 될 것이다.

###### single_post_page() 함수 정의하기
from django.shortcuts import render
from .models import Post

# Create your views here.
``` python 
def index(request):
    posts = Post.objects.all().order_by('-pk')

    return render(
        request,
        'blog/index.html',
        {
            'posts': posts
        }
    )

def single_post_page(request, pk):
    post = Post.objects.get(pk=pk)# 괄호 안의 조건을 만족하는 포스트를 Post 객체를 가져오시오.
    
    # 가져온 Post 레코드 하나를 blog/single_post_page.html에 담아 렌더링하시오.
    return render(
        request,
        'blog/single_post_page.html',
        {
            'post': post
        }
    )
```
Post 모델의 pk 필드 값이 single_post_page() 함수의 매개 변수와 같은 레코드를 가져오라는 의미라고 볼 수 있다.
그리고 이제 /blog 디렉터리 이하의 `sing_post_page.html` 파일을 작성해야 할 것이다.

###### URL을 이용한 쿼리 확인하기
- html 파일을 작성하지 않고 서버를 동작시켜서 <u>웹서버/blog/1</u>에 접속한다면 `TemplateDoesNotExist at Blog/1`이라는 에러 문구가 발생합니다. 
- 또한, 실제 존재하지 않는 포스팅의 pk의 URL을 사용한 경우 `DoesNotExist at Blog/99999`라는 오류 문구를 볼 수 있습니다. 왜냐하면 매개변수의 pk와 같은 pk를 가진 Post 객체가 존재하지 않기 때문입니다.

또한, 하단의 Traceback을 통해 문제가 발생한 파일과 그 행에 대해 지시하고 있어 참고하면 좋을 듯 합니다.

###### 템플릿 파일 만들기
앞서 말한 첫번째 문제를 해결하기 위해서 blog/template/blog에 `single_post_page.html`을 작성합니다.
``` html 
<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <!-- 타이틀은 포스트 제목 뒤에 '- blog' -->
    <title>{{post.title}} - Blog</title>
</head>

<body>
    <nav>
        <!-- 블로그 목록으로 갈 수 있는 링크 생성 -->
        <a href="/blog">Blog</a> 
    </nav>
    <h1>{{post.title}}</h1>
    <h4>{{post.created_at}}</h4>
    <p>{{post.content}}</p>
    <hr />
    <h3>여기 댓글이 들어올 수 있겠죠?</h3>
</body>

</html>
```
아직 진행하지는 않았지만, body의 댓글을 추가하는 코드를 넣는다면 댓글 목록을 보고 작성할 수 있는 인터페이스가 구축될 것이라고 생각합니다.

##### 포스트 제목에 링크 만들기
우리는 포스트 상세 페이지에서 포스트 목록 페이지로 이동할 수 있지만, 반대 방향으로의 이동은 불가능합니다.

###### index.html 수정하기
블로그 목록 페이지와 관련된 것이므로 우선 목록 페이지의 디자인을 보여주는 `blog/template/blog/index.html`에서 코드를 다음과 같이 수정합니다.
``` html
<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>Blog</title>
</head>

<body>
    <h1>Blog</h1>
    {% for p in posts %}
    <hr />
    <!-- 절대 URL을 가져오라? -->
    <h2><a href="{{p.get_absolute_url}}">{{p.title}}</a></h2>
    <h4>{{p.created_at}}</h4>
    <p>{{p.content}}</p>
    {% endfor %}
</body>

</html>
```
링크를 추가했습니다. 동작 원리를 아직 잘 모르겠지만, 각 포스트 객체의 제목에 무슨 조작이 가해졌을 것입니다. 궁금증을 해소하기 위해서 실제로 서버를 새로 고쳐보면 예상했던 대로 제목에 링크가 걸려있는 것 같지만, 클릭해보면 동작을 하지 않습니다.

###### get_absolute_url() 함수 정의하기
왜냐하면, `p.get_absolute_url`이 무엇인지 알 수 없어서 href가 아무 것도 없는 빈값을 가지기 때문입니다. 그렇기에 그것을 정의해야 하는데, 이것은 views.py에 수행하는 것이 아닌 `models.py`에서 수행합니다. 

※ views.py와 models.py의 차이는 아직 명확하게 정리하지 못하였지만, 짐작컨대 view는 사용자에게 보이는 인터페이스와 관련된 함수를 model은 보이지 않는 부분의 동작을 정의하는 파일일 것이라고 추청하고 있다.

``` python
from django.db import models

# Create your models here.
class Post(models.Model):
    title = models.CharField(max_length=30)
    content = models.TextField()

    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    # author: 추후 작성 예정

    def __str__(self):
        return f'[{self.pk}]{self.title}'
    
    # 함수가 호출되면 blog/pk 값을 돌려줘라
    def get_absolute_url(self):
        return f'/blog/{self.pk}'

```
이제 블로그의 포스팅 목록 페이지에서 제목을 클릭해도 상세 페이지로 이동하는 모습을 살펴볼 수 있습니다. 게다가 <u>웹서버/admin</u> 으로 접속하여 관리자 페이지를 살펴보면 Histroy 옆에 View on site라는 단추가 있는데 그것을 클릭하면 바로 상세 페이지로 이동합니다.

포스팅 목록이 있는 페이지로 들어가서 `ctrl` + `u`를 클릭하여 소스 코드를 확인해보면 다음과 같이 <'a'> 태그에 href 값이 잘 할당되어 있는 모습을 확인할 수 있습니다.
![image](https://github.com/qldrh112/TIL/assets/69291489/c3c2cf00-8a64-40b6-968d-ef0785256631)

##### 대문 페이지와 자기소개 페이지 만들기
대문 페이지: 도메인 뒤에 아무 것도 붙지 않았을 때 나타나는 페이지  
현재 사용하고 있는 127.0.0.1:8000은 도메인은 아니다.

###### single_pages 앱을 위한 URL 지정하기
대문 페이지와 관련한 사항은 single_page 앱에서 처리하도록 합니다.
이때, 프로젝트 폴더에 있는 이정표 파일인 urls.py에서 다음과 같이 코드를 추가합니다.

``` python
from django.contrib import admin
from django.urls import path, include

urlpatterns = [
    path("blog/", include('blog.urls')),
    path("admin/", admin.site.urls),
    # 아무것도 붙지 않았을 대, single_pages 하위에 있는 urls에서 처리하시오.
    path("", include('single_pages.urls')),
]
```

###### 대문 페이지와 자기소개 페이지의 URL 지정하기
single_pages/ 에 `uris.py`을 생성하여 ①도메인 뒤에 아무것도 없을 때는 대문 페이지로 ②도메인 뒤에 about_me/가 있을 때는 자기소개 페이지로 이동할 수 있게 합니다.

``` python
from django.urls import path
from . import views

urlpatterns = [
    path('about_me/', views.about_me),
    path('', views.landing),
]
```

###### views.py에 함수 정의하기
`urls.py`의 수정이 끝났다면 해당하는 함수를 정의하는 views.py 파일을 만들어 함수를 정의해야 합니다. 이번 챕터의 목표인 FBV를 사용하여 정의해 봅시다.

```python
from django.shortcuts import render

# landing.html을 보여주기
def landing(request):
    return render(
        request,
        'single_pages/landing.html'
    )

# about_me.html을 보여주기
def about_me(request):
    return render(
        request,
        'single_pages/about_me.html'
    )
```
앞서 수행한 블로그의 views.py와 다른 점은 render() 함수를 통해 딕셔너리를 사용하지 않는데 그 이유는 블로그(`{'post':post}`)와 달리 데이터베이스와 연결할 요소가 없기 때문입니다. 

###### 템플릿 파일 만들기
이제 각각의 함수가 보여줘야 하는 .html 파일을 제작해야 한다. 블로그와 마찬가지로 single_pages/templates/single_pages 하위에 `landing.html`와 `about_me.html`파일을 만들고 다음과 같이 작성합니다.

<landing.html>
``` html
<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>이규석입니다!</title>
</head>

<body>
    <nav>
        <a href="/blog">Blog</a>
        <a href="/about_me">About me</a>
    </nav>

    <h1>안녕하세요. 이규석입니다.</h1>
    <h2>대문페이지</h2>
    <h3>아직 만들지 않음</h3>
</body>

</html>
```

<about_me.html>
``` html
<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>개발자 이규석입니다.</title>
</head>

<body>
    <nav>
        <a href="/blog">Blog</a>
        <a href="/about_me">About me</a>
    </nav>

    <h1>안녕하세요. 이규석입니다.</h1>
    <h2>이력</h2>
    <h2>Portfolio</h2>
    <h3>아직 공사중입니다.</h3>
</body>

</html>
```

![image](https://github.com/qldrh112/TIL/assets/69291489/4862f2f9-d2a9-4beb-a931-75ad3899b46c)

이와 같이 페이지 틀이 구성된 것을 확인할 수 있다.